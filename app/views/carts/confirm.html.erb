<div class="container">
  <div class="row">
    <h1>注文確認</h1>
    <p>小計：¥<%= @sum_price %></p>
    <p>送料：¥500</p>
    <h4>ご請求額：¥<%= @sum_price.to_i + 500 %></h4>
    <%
=begin%>
 <p id="updated_by_ajax">送付先：<%= @user.address %></p> 
<%
=end%>
    <p id="address_result">送付先：<%= @user.address %></p> 

    <p class="btn btn-default" id="dest-select">送付先を選択</p> 
  </div>

  <div class="row">
    <%= link_to "カートに戻る", cart_path(@cart), class:"btn btn-default" %>
    <%= form_for(@order) do |f| %>
      <%= f.submit "注文を確定する", class:"btn btn-primary" %>
    <% end %>
  </div>

  <h4>購入商品一覧</h4>
  <% @cart_products.each do |cart_product| %>
    <div class="row">
      <div class="col-xs-2">
        <%= attachment_image_tag cart_product.product, :image, :fill, 120, 120, format: 'jpeg', class:"jacket-image", fallback:"img/no_image.png", :size => '120x120' %>
      </div>
      <div class="col-xs-8">
        <p>
          <%= link_to cart_product.product.product_title, product_path(cart_product.product) %>
          <% artist_ary = cart_product.product.artists.uniq %>
          <% artist_ary.each do |artist| %>
            <%= artist.artist_name %>
          <% end %>
        </p>
        <p><%= cart_product.product.genre.genre_name %></p>
        <p>単価：¥<%= cart_product.product.product_price %></p>
        <p>数量：<%= cart_product.quantity %></p>
        <p>合計：¥<%= cart_product.product.product_price*cart_product.quantity %></p>
      </div>
    </div>
  <% end %>


  <%
=begin%>
  送付先洗濯用モーダル
<%
=end%>

<div id="overlay">
	<div id="result">
		<h2>送付先変更</h2>
    <p><input type="radio" name="dest_id" value="default" checked>デフォルトの送付先</p>
    <p>お名前：<%= @user.user_name %></p>
    <p>ご住所：<%= @user.address %></p> 

    <% dest_count = 1 %>
		<% @destinations.each do |destination| %>
      <div id="select_dest">
        <input type="radio" name="dest_id" value="<%= destination.id %>">送付先<%= dest_count %> 
        <p>お名前：<%= destination.destination_name %></p>
        <p>ご住所：<%= destination.destination_address %></p>
      </div>
      <%
=begin%>
 <div id="request_ajax_update" >
        <%= form_tag(ajax_test_update_path, method: :post, remote: true) { %>
          <%= hidden_field :data, destination.id %>
          <%= submit_tag 'この配送先に変更', id:"go", class:"btn btn-primary" %>
        <% } %>
      </div> 
<%
=end%>
      <% dest_count += 1 %>
    <% end %>
    <button id="close">キャンセル</button>
    <button id="go" class="btn btn-primary">確定</button> 
	</div>
</div>

<script>
	$(function(){
    // モーダル表示用
		$('#dest-select').on('click',function(){
			$('#overlay,#result').fadeIn();
    });

    // モーダル閉じる用
		$('#close').on('click', function(){
			$('#overlay,#result').fadeOut();
    });

    // 確定ボタン
    $('#go').on('click', function(){
      var selected_dest_id = $("[name=dest_id]:checked").val();
      $.cookie('selected_dest_id', selected_dest_id, {path: "/"});
      $('#address_result').text("送付先：" + selected_dest_id);
      $('#overlay,#result').fadeOut();
      alert("配送先を変更しました");
    });
	});
</script>